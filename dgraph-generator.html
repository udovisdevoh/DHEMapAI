<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Générateur de Prompt D-Graph (Définitif)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
            max-width: 900px;
            margin: auto;
            background-color: #f0f2f5;
            color: #1d2129;
        }

        .container {
            background-color: #fff;
            padding: 20px 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        h1 {
            color: #1877f2;
            text-align: center;
            border-bottom: 2px solid #e1e4e8;
            padding-bottom: 15px;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #606770;
            margin-bottom: 25px;
            font-style: italic;
            font-size: 0.9em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #4b4f56;
        }

        input[type="text"], select, textarea {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ccd0d5;
            border-radius: 6px;
            box-sizing: border-box;
            transition: all 0.2s;
        }

            input[type="text"]:focus, select:focus, textarea:focus {
                border-color: #1877f2;
                outline: none;
                box-shadow: 0 0 0 2px rgba(24, 119, 242, 0.2);
            }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .button-container {
            text-align: center;
            margin-top: 25px;
            margin-bottom: 25px;
        }

        button {
            background-color: #1877f2;
            color: white;
            border: none;
            padding: 14px 28px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }

            button:hover {
                background-color: #166fe5;
            }

        .output-container {
            margin-top: 30px;
            position: relative;
        }

        #promptOutput {
            background-color: #f0f2f5;
            color: #333;
            font-family: Consolas, 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            border-color: #e1e4e8;
        }

        #copyButton {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #6c757d;
            font-size: 14px;
            padding: 8px 12px;
            font-weight: normal;
        }

            #copyButton:hover {
                background-color: #5a6268;
            }

        @media (max-width: 600px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Générateur de Dossier de Conception (D-Graph)</h1>
        <p class="subtitle">Cet outil instruit une IA pour qu'elle agisse comme un level designer et un artiste d'environnement.</p>

        <div class="form-grid">
            <div class="form-group">
                <label for="gameSelect">Jeu</label>
                <select id="gameSelect">
                    <option value="doom">Doom</option>
                    <option value="doom2" selected>Doom 2</option>
                    <option value="heretic">Heretic</option>
                    <option value="hexen">Hexen</option>
                </select>
            </div>
            <div class="form-group">
                <label for="themeSelect">Thème de la Carte</label>
                <select id="themeSelect"></select>
            </div>
            <div class="form-group full-width" id="customThemeContainer" style="display: none;">
                <label for="customThemeInput">Thème Personnalisé</label>
                <input type="text" id="customThemeInput" placeholder="Ex: Cité sous-marine biomecanique">
            </div>
            <div class="form-group">
                <label for="sizeSelect">Nombre de Pièces</label>
                <select id="sizeSelect">
                    <option value="très petite (3-5 pièces)">Très Petite (3-5)</option>
                    <option value="petite (6-9 pièces)" selected>Petite (6-9)</option>
                    <option value="moyenne (10-15 pièces)">Moyenne (10-15)</option>
                    <option value="grande (16-25 pièces)">Grande (16-25)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="connectivitySelect">Connectivité</label>
                <select id="connectivitySelect">
                    <option value="linéaire">Linéaire (A -> B -> C)</option>
                    <option value="avec embranchements" selected>Avec embranchements</option>
                    <option value="en hub (une pièce centrale)">En hub</option>
                    <option value="non-linéaire et complexe">Non-linéaire</option>
                </select>
            </div>
        </div>
        <div class="form-group full-width">
            <label for="descriptionText">Brief Créatif (Facultatif)</label>
            <textarea id="descriptionText" placeholder="Décrivez l'objectif de la carte, une idée de progression, une ambiance particulière..."></textarea>
        </div>

        <div class="button-container"><button type="button" id="generateButton">Générer le Prompt</button></div>

        <div class="output-container">
            <label for="promptOutput">Prompt Généré (Dossier de Conception Complet)</label>
            <textarea id="promptOutput" rows="25" readonly></textarea>
            <button id="copyButton">Copier le Prompt</button>
        </div>
    </div>

    <script>
        const GAME_DATA = {
            doom: {
                themes: ["Base Technologique (E1)", "Rivages de l'Enfer (E2)", "Base Gothique/Corrompue (E3)", "Laboratoire de Slime"],
                things: [{ "type": 1, "name": "Player 1 Start" }, { "type": 2, "name": "Player 2 Start" }, { "type": 3, "name": "Player 3 Start" }, { "type": 4, "name": "Player 4 Start" }, { "type": 11, "name": "Deathmatch Start" }, { "type": 3004, "name": "Zombieman" }, { "type": 9, "name": "Shotgun Guy" }, { "type": 3001, "name": "Imp" }, { "type": 3002, "name": "Demon" }, { "type": 58, "name": "Spectre" }, { "type": 3006, "name": "Lost Soul" }, { "type": 3005, "name": "Cacodemon" }, { "type": 3003, "name": "Baron of Hell" }, { "type": 7, "name": "Spider Mastermind" }, { "type": 16, "name": "Cyberdemon" }, { "type": 84, "name": "Boss Brain" }, { "type": 2007, "name": "Shotgun" }, { "type": 2008, "name": "Chaingun" }, { "type": 2002, "name": "Rocket Launcher" }, { "type": 2003, "name": "Plasma Gun" }, { "type": 2004, "name": "BFG9000" }, { "type": 2006, "name": "Chainsaw" }, { "type": 2001, "name": "Fist (non-droppable)" }, { "type": 2001, "name": "Pistol (non-droppable)" }, { "type": 2010, "name": "Ammo Clip" }, { "type": 2048, "name": "Box of Bullets" }, { "type": 2046, "name": "4 Shotgun Shells" }, { "type": 2049, "name": "Box of Shotgun Shells" }, { "type": 2047, "name": "Rocket" }, { "type": 2010, "name": "Box of Rockets" }, { "type": 2047, "name": "Energy Cell" }, { "type": 17, "name": "Energy Cell Pack" }, { "type": 2011, "name": "Backpack" }, { "type": 2012, "name": "Stimpack" }, { "type": 2013, "name": "Medikit" }, { "type": 2014, "name": "Health Potion (+1)" }, { "type": 2015, "name": "Armor Bonus (+1)" }, { "type": 2018, "name": "Green Armor" }, { "type": 2019, "name": "Blue Armor" }, { "type": 2025, "name": "Megasphere" }, { "type": 83, "name": "Soulsphere" }, { "type": 2022, "name": "Invulnerability" }, { "type": 2023, "name": "Berserk" }, { "type": 2024, "name": "Partial Invisibility" }, { "type": 2045, "name": "Radiation Suit" }, { "type": 2026, "name": "Computer Area Map" }, { "type": 8, "name": "Light Amplification Goggles" }, { "type": 5, "name": "Blue Keycard" }, { "type": 13, "name": "Yellow Keycard" }, { "type": 6, "name": "Red Keycard" }, { "type": 39, "name": "Yellow Skull Key" }, { "type": 38, "name": "Red Skull Key" }, { "type": 40, "name": "Blue Skull Key" }, { "type": 2035, "name": "Exploding Barrel" }, { "type": 70, "name": "Burning Barrel" }, { "type": 43, "name": "Tall Green Pillar" }, { "type": 44, "name": "Tall Red Pillar" }, { "type": 45, "name": "Short Green Pillar" }, { "type": 46, "name": "Short Red Pillar" }, { "type": 30, "name": "Tall Green Pillar with Heart" }, { "type": 32, "name": "Tall Red Pillar with Skull" }, { "type": 31, "name": "Short Green Pillar with Skull" }, { "type": 33, "name": "Short Red Pillar with Heart" }, { "type": 48, "name": "Stalagmite" }, { "type": 2028, "name": "Floor Lamp" }, { "type": 22, "name": "Impaled Human 1" }, { "type": 23, "name": "Impaled Human 2" }, { "type": 28, "name": "Twitching Impaled Human" }, { "type": 27, "name": "Skull on a Pole" }, { "type": 29, "name": "Five Skulls Shish Kebab" }, { "type": 24, "name": "Pile of Skulls and Candles" }, { "type": 47, "name": "Tall Technicolor Pillar" }, { "type": 41, "name": "Gray Tree" }, { "type": 42, "name": "Brown Tree" }, { "type": 35, "name": "Candle" }, { "type": 34, "name": "Candelabra" }, { "type": 25, "name": "Hanging Victim (Twitching) 1" }, { "type": 26, "name": "Hanging Victim (Twitching) 2" }, { "type": 15, "name": "Hanging Victim (Arms Out)" }, { "type": 10, "name": "Hanging Victim (One Leg)" }, { "type": 12, "name": "Hanging Victim (Legs Apart)" }, { "type": 71, "name": "Hanging Victim (Twitching) 3" }, { "type": 63, "name": "Hanging Victim (Twitching) 4" }, { "type": 53, "name": "Hanging Pair of Legs" }, { "type": 49, "name": "Pool of Blood and Guts 1" }, { "type": 50, "name": "Pool of Blood and Guts 2" }, { "type": 51, "name": "Pool of Blood" }, { "type": 52, "name": "Pool of Brains" }, { "type": 59, "name": "Dead Player" }, { "type": 19, "name": "Dead Zombieman" }, { "type": 20, "name": "Dead Shotgun Guy" }, { "type": 21, "name": "Dead Imp" }, { "type": 18, "name": "Dead Demon" }, { "type": 57, "name": "Dead Cacodemon" }, { "type": 55, "name": "Dead Lost Soul (invisible)" }, { "type": 56, "name": "Dead Baron of Hell" }],
                textures: ["AASHIT1", "AASHIT2", "BARREL", "BIGDOOR1", "BIGDOOR2", "BIGDOOR3", "BIGDOOR4", "BIGDOOR5", "BIGDOOR6", "BIGDOOR7", "BRICK1", "BRICK2", "BRICK3", "BRICK4", "BRICK5", "BRICK6", "BRICK7", "BRICK8", "BRICK9", "BRICK10", "BRICK11", "BRICK12", "BRNPOIS", "BROWN1", "BROWN96", "BROWNGRN", "CEIL3_1", "CEIL3_2", "CEIL4_1", "CEIL4_2", "CEIL4_3", "CEIL5_1", "CEIL5_2", "COMPTALL", "CRAT1", "CRAT2", "CRAT3", "DOOR1", "DOOR3", "DOORBLU", "DOORRED", "DOORYEL", "DOORTRAK", "EXITDOOR", "EXITSIGN", "GRAY1", "GRAY4", "GRAY7", "GRAYTALL", "GSTANCE", "LITE1", "LITE2", "LITE3", "LITE4", "LITE5", "LITEBLU", "LITEGRN", "LITERED", "MARBLE1", "MARBLE2", "MARBLE3", "MARBLE4", "METAL", "METAL1", "METAL2", "METAL3", "METAL4", "METAL5", "METAL6", "METAL7", "NUKAGE1", "NUKAGE2", "NUKAGE3", "PLAT1", "PLAT2", "PLAT3", "ROCK01", "ROCK02", "ROCK03", "ROCK04", "ROCK05", "SHAWN1", "SHAWN2", "SKIN1", "SKIN2", "SKIN3", "SKINBORD", "SKY1", "SKY2", "SKY3", "SLADWALL", "SP_HOT1", "SP_HOT2", "SP_HOT3", "SP_HOT4", "STARG1", "STARG2", "STARGR1", "STEP1", "STEP2", "STEP3", "STEP4", "STEP5", "STEP6", "SUPPORT1", "SUPPORT2", "SUPPORT3", "SW1BRN1", "SW1BRN2", "SW1COMM", "SW1COMP", "SW1EXIT", "SW1GRAY", "SW1GREN", "SW1HOT", "SW1LIT", "SW1MARB", "SW1METAL", "SW1PIPE", "SW1ROCK", "SW1SKIN", "SW1STAR", "SW1STON", "SW1WOOD", "SW2BRN1", "SW2BRN2", "SW2COMM", "SW2COMP", "SW2EXIT", "SW2GRAY", "SW2GREN", "SW2HOT", "SW2LIT", "SW2MARB", "SW2METAL", "SW2PIPE", "SW2ROCK", "SW2SKIN", "SW2STAR", "SW2STON", "SW2WOOD", "TEKWALL1", "TEKWALL2", "TEKWALL3", "TEKWALL4", "WOOD1", "WOOD2", "WOOD3", "WOOD4", "WOOD5", "WOOD6", "WOOD7", "WOOD8", "WOOD9"],
                flats: ["CEIL1_1", "CEIL1_2", "CEIL1_3", "CEIL2_1", "CEIL2_2", "CEIL2_3", "CEIL3_1", "CEIL3_2", "CEIL3_3", "CEIL4_1", "CEIL4_2", "CEIL4_3", "CEIL5_1", "CEIL5_2", "COMP01", "F_SKY1", "F_SKY2", "F_SKY3", "FLAT1", "FLAT2", "FLAT3", "FLAT4", "FLAT5", "FLAT6", "FLAT8", "FLAT9", "FLAT10", "FLAT12", "FLAT13", "FLAT14", "FLAT15", "FLAT16", "FLAT17", "FLAT18", "FLAT19", "FLAT20", "FLAT21", "FLAT22", "FLAT23", "FLOOR0_1", "FLOOR0_2", "FLOOR0_3", "FLOOR0_4", "FLOOR0_5", "FLOOR0_6", "FLOOR0_7", "FLOOR1_1", "FLOOR1_6", "FLOOR1_7", "FLOOR3_3", "FLOOR4_1", "FLOOR4_5", "FLOOR4_6", "FLOOR4_8", "FLOOR5_1", "FLOOR5_2", "FLOOR5_3", "FLOOR5_4", "FWATER1", "FWATER2", "FWATER3", "FWATER4", "LAVA1", "LAVA2", "LAVA3", "LAVA4", "MFLR8_1", "MFLR8_2", "MFLR8_3", "MFLR8_4", "NUKAGE1", "NUKAGE2", "NUKAGE3", "RROCK01", "RROCK02", "RROCK03", "RROCK04", "SLIME09", "SLIME10", "SLIME11", "SLIME12", "TLITE6_1", "TLITE6_4", "TLITE6_5", "TLITE6_6"],
                music: ["D_E1M1", "D_E1M2", "D_E1M3", "D_E1M4", "D_E1M5", "D_E1M6", "D_E1M7", "D_E1M8", "D_E1M9", "D_E2M1", "D_E2M2", "D_E2M3", "D_E2M4", "D_E2M5", "D_E2M6", "D_E2M7", "D_E2M8", "D_E2M9", "D_E3M1", "D_E3M2", "D_E3M3", "D_E3M4", "D_E3M5", "D_E3M6", "D_E3M7", "D_E3M8", "D_E3M9", "D_INTER", "D_INTRO", "D_BUNNY", "D_VICTOR", "D_INTROA", "D_EVIL", "D_ULTIMA"],
                actions: [{ "id": 1, "name": "DR Door Open Wait Close" }, { "id": 11, "name": "Exit Level" }, { "id": 14, "name": "Raise Floor to Nearest" }, { "id": 18, "name": "Raise Floor" }, { "id": 20, "name": "Raise Plat" }, { "id": 21, "name": "Raise Plat by Value" }, { "id": 23, "name": "Raise Floor to Crush" }, { "id": 103, "name": "Door Open" }]
            },
            doom2: {
                themes: ["Complexe Industriel UAC", "Enfer sur Terre", "Ville en Ruines", "Forteresse Gothique", "Usine de Traitement", "Niveau Abstrait"],
                things: [{ "type": 1, "name": "Player 1 Start" }, { "type": 2, "name": "Player 2 Start" }, { "type": 3, "name": "Player 3 Start" }, { "type": 4, "name": "Player 4 Start" }, { "type": 11, "name": "Deathmatch Start" }, { "type": 3004, "name": "Zombieman" }, { "type": 9, "name": "Shotgun Guy" }, { "type": 64, "name": "Heavy Weapon Dude" }, { "type": 3001, "name": "Imp" }, { "type": 3002, "name": "Demon" }, { "type": 58, "name": "Spectre" }, { "type": 3006, "name": "Lost Soul" }, { "type": 3005, "name": "Cacodemon" }, { "type": 69, "name": "Hell Knight" }, { "type": 3003, "name": "Baron of Hell" }, { "type": 68, "name": "Arachnotron" }, { "type": 71, "name": "Pain Elemental" }, { "type": 66, "name": "Revenant" }, { "type": 67, "name": "Mancubus" }, { "type": 7, "name": "Spider Mastermind" }, { "type": 16, "name": "Cyberdemon" }, { "type": 65, "name": "Arch-Vile" }, { "type": 88, "name": "SS Wolfenstein" }, { "type": 84, "name": "Boss Shooter (Icon of Sin)" }, { "type": 87, "name": "Commander Keen" }, { "type": 2007, "name": "Shotgun" }, { "type": 82, "name": "Super Shotgun" }, { "type": 2008, "name": "Chaingun" }, { "type": 2002, "name": "Rocket Launcher" }, { "type": 2003, "name": "Plasma Gun" }, { "type": 2004, "name": "BFG9000" }, { "type": 2006, "name": "Chainsaw" }, { "type": 2010, "name": "Ammo Clip" }, { "type": 2048, "name": "Box of Bullets" }, { "type": 2046, "name": "4 Shotgun Shells" }, { "type": 2049, "name": "Box of Shotgun Shells" }, { "type": 2047, "name": "Rocket" }, { "type": 2010, "name": "Box of Rockets" }, { "type": 2047, "name": "Energy Cell" }, { "type": 17, "name": "Energy Cell Pack" }, { "type": 2011, "name": "Backpack" }, { "type": 2012, "name": "Stimpack" }, { "type": 2013, "name": "Medikit" }, { "type": 2014, "name": "Health Potion (+1)" }, { "type": 2015, "name": "Armor Bonus (+1)" }, { "type": 2018, "name": "Green Armor" }, { "type": 2019, "name": "Blue Armor" }, { "type": 83, "name": "Megasphere" }, { "type": 2022, "name": "Invulnerability" }, { "type": 2023, "name": "Berserk" }, { "type": 2024, "name": "Partial Invisibility" }, { "type": 2045, "name": "Radiation Suit" }, { "type": 2026, "name": "Computer Area Map" }, { "type": 8, "name": "Light Amplification Goggles" }, { "type": 5, "name": "Blue Keycard" }, { "type": 13, "name": "Yellow Keycard" }, { "type": 6, "name": "Red Keycard" }, { "type": 39, "name": "Yellow Skull Key" }, { "type": 38, "name": "Red Skull Key" }, { "type": 40, "name": "Blue Skull Key" }, { "type": 2035, "name": "Exploding Barrel" }],
                textures: ["AASHIT1", "AASHIT2", "ASHWALL", "BARNS", "BARREL", "BIGDOOR1", "BIGDOOR2", "BIGDOOR3", "BIGDOOR4", "BIGDOOR5", "BIGDOOR6", "BIGDOOR7", "BRICK1", "BRICK2", "BRICK3", "BRICK4", "BRICK5", "BRICK6", "BRICK7", "BRICK8", "BRICK9", "BRICK10", "BRICK11", "BRICK12", "BRNPOIS", "BRONZE1", "BRONZE2", "BRONZE3", "BRONZE4", "BROWN1", "BROWN96", "BROWNGRN", "CEMENT1", "CEMENT2", "CEMENT3", "CEMENT4", "CEMENT5", "CEMENT6", "CEMENT7", "CEMENT8", "CEMENT9", "COMP1", "COMP2", "COMPTALL", "COMPUTER", "CRATE1", "CRATE2", "CRATE3", "CRATETOP", "CRATIN", "DOOR1", "DOOR3", "DOORBLU", "DOORRED", "DOORYEL", "DOORTRAK", "EXITDOOR", "EXITSIGN", "GRAY1", "GRAY4", "GRAY7", "GRAYTALL", "GSTANCE", "GSTONE1", "GSTONE2", "GSTONPOP", "ICWALL1", "ICWALL2", "ICWALL3", "ICWALL4", "ICWALL5", "LITE1", "LITE2", "LITE3", "LITE4", "LITE5", "LITEBLU", "LITEGRN", "LITERED", "MARB1", "MARB2", "MARB3", "MARBFAC1", "MARBFAC2", "MARBFAC3", "MARBFAC4", "MARBLE1", "MARBLE2", "MARBLE3", "MARBLE4", "METAL", "METAL1", "METAL2", "METAL3", "METAL4", "METAL5", "METAL6", "METAL7", "MIDGRATE", "MOSS1", "MOSS2", "MOSS3", "NUKAGE1", "NUKAGE2", "NUKAGE3", "PIPE1", "PIPE2", "PIPE3", "PIPE4", "PIPE5", "PIPE6", "PLAT1", "PLAT2", "PLAT3", "ROCK01", "ROCK02", "ROCK03", "ROCK04", "ROCK05", "ROCK06", "ROCK07", "ROCK08", "SHAWN1", "SHAWN2", "SKIN1", "SKIN2", "SKIN3", "SKINBORD", "SKY1", "SKY2", "SKY3", "SLADWALL", "SP_FACE1", "SP_FACE2", "SP_HOT1", "SP_HOT2", "SP_HOT3", "SP_HOT4", "STARG1", "STARG2", "STARGR1", "STEP1", "STEP2", "STEP3", "STEP4", "STEP5", "STEP6", "STONE1", "STONE2", "STONE3", "STONE4", "STONPOIS", "SUPPORT1", "SUPPORT2", "SUPPORT3", "SW1BRN1", "SW1BRN2", "SW1COMM", "SW1COMP", "SW1EXIT", "SW1GRAY", "SW1GREN", "SW1HOT", "SW1LIT", "SW1MARB", "SW1METAL", "SW1PIPE", "SW1ROCK", "SW1SKIN", "SW1STAR", "SW1STON", "SW1WOOD", "SW2BRN1", "SW2BRN2", "SW2COMM", "SW2COMP", "SW2EXIT", "SW2GRAY", "SW2GREN", "SW2HOT", "SW2LIT", "SW2MARB", "SW2METAL", "SW2PIPE", "SW2ROCK", "SW2SKIN", "SW2STAR", "SW2STON", "SW2WOOD", "SWITCH1", "SWITCH2", "SWTCHPNL", "TEKBRON", "TEKGREN", "TEKWALL1", "TEKWALL2", "TEKWALL3", "TEKWALL4", "TEKWALL5", "WOOD1", "WOOD2", "WOOD3", "WOOD4", "WOOD5", "WOOD6", "WOOD7", "WOOD8", "WOOD9", "ZZWOLF1", "ZZWOLF2", "ZZWOLF3", "ZZWOLF4", "ZZWOLF5", "ZZWOLF6", "ZZWOLF7", "ZZWOLF8"],
                flats: ["CEIL1_1", "CEIL1_2", "CEIL1_3", "CEIL2_1", "CEIL2_2", "CEIL2_3", "CEIL3_1", "CEIL3_2", "CEIL3_3", "CEIL4_1", "CEIL4_2", "CEIL4_3", "CEIL5_1", "CEIL5_2", "COMP01", "CRATOP1", "CRATOP2", "DEM1_1", "DEM1_2", "DEM1_3", "DEM1_4", "DEM1_5", "DEM1_6", "F_SKY1", "FLAT1", "FLAT2", "FLAT3", "FLAT4", "FLAT5", "FLAT6", "FLAT8", "FLAT9", "FLAT10", "FLAT12", "FLAT13", "FLAT14", "FLAT15", "FLAT16", "FLAT17", "FLAT18", "FLAT19", "FLAT20", "FLAT21", "FLAT22", "FLAT23", "FLAT5_1", "FLAT5_2", "FLAT5_3", "FLAT5_4", "FLAT5_5", "FLAT5_6", "FLAT5_7", "FLAT5_8", "FLOOR0_1", "FLOOR0_2", "FLOOR0_3", "FLOOR0_4", "FLOOR0_5", "FLOOR0_6", "FLOOR0_7", "FLOOR1_1", "FLOOR1_6", "FLOOR1_7", "FLOOR3_3", "FLOOR4_1", "FLOOR4_5", "FLOOR4_6", "FLOOR4_8", "FLOOR5_1", "FLOOR5_2", "FLOOR5_3", "FLOOR5_4", "FWATER1", "FWATER2", "FWATER3", "FWATER4", "GATE1", "GATE2", "GATE3", "GATE4", "GRASS1", "GRASS2", "LAVA1", "LAVA2", "LAVA3", "LAVA4", "MFLR8_1", "MFLR8_2", "MFLR8_3", "MFLR8_4", "NUKAGE1", "NUKAGE2", "NUKAGE3", "RROCK01", "RROCK02", "RROCK03", "RROCK04", "RROCK05", "RROCK06", "RROCK07", "RROCK08", "SLIME01", "SLIME02", "SLIME03", "SLIME04", "SLIME05", "SLIME06", "SLIME07", "SLIME08", "SLIME09", "SLIME10", "SLIME11", "SLIME12", "STEP1", "STEP2", "TECH01", "TECH02", "TECH03", "TECH04", "TECHF1", "TECHF2", "TECHF3", "TECHF4", "TLITE6_1", "TLITE6_4", "TLITE6_5", "TLITE6_6"],
                music: ["D_RUNNIN", "D_STALKS", "D_COUNTD", "D_BETWEE", "D_DOOM", "D_THE_D", "D_SHAWN", "D_DDTBLU", "D_IN_CIT", "D_DEAD", "D_STLKS2", "D_THE_DA", "D_DOOM2", "D_RUNNI2", "D_DEAD2", "D_STLKS3", "D_ROMERO", "D_SHAWN2", "D_MESSAG", "D_AMPIE", "D_ADRIAN", "D_MESSG2", "D_ROMER2", "D_TENSE", "D_OPENIN", "D_EVIL", "D_ULTIMA", "D_READ_M", "D_DM2TTL", "D_DM2INT"],
                actions: [{ "id": 1, "name": "DR Door Open Wait Close" }, { "id": 11, "name": "Exit Level" }, { "id": 14, "name": "Raise Floor to Nearest" }, { "id": 18, "name": "Raise Floor" }, { "id": 20, "name": "Raise Plat" }, { "id": 21, "name": "Raise Plat by Value" }, { "id": 23, "name": "Raise Floor to Crush" }, { "id": 103, "name": "Door Open" }]
            },
            heretic: {
                themes: ["Château Médiéval", "Donjon Volcanique", "Donjons Inondés", "Temple de la Forêt"],
                things: [{ "type": 14, "name": "Player 1 Start" }, { "type": 1, "name": "Player 2 Start" }, { "type": 2, "name": "Player 3 Start" }, { "type": 3, "name": "Player 4 Start" }, { "type": 4, "name": "Deathmatch Start" }, { "type": 66, "name": "Golem" }, { "type": 67, "name": "Ghost Golem" }, { "type": 70, "name": "Nitrogolem" }, { "type": 71, "name": "Ghost Nitrogolem" }, { "type": 10, "name": "Undead Warrior" }, { "type": 11, "name": "Ghost Undead Warrior" }, { "type": 68, "name": "Gargoyle" }, { "type": 69, "name": "Fire Gargoyle" }, { "type": 9, "name": "Disciple of D'Sparil" }, { "type": 65, "name": "Sabreclaw" }, { "type": 8, "name": "Weredragon" }, { "type": 35, "name": "Ophidian" }, { "type": 36, "name": "Iron Lich" }, { "type": 7, "name": "Maulotaur" }, { "type": 6, "name": "D'Sparil" }, { "type": 2005, "name": "Ethereal Crossbow" }, { "type": 2003, "name": "Dragon's Claw" }, { "type": 2004, "name": "Hellstaff" }, { "type": 2002, "name": "Phoenix Rod" }, { "type": 2006, "name": "Mace" }, { "type": 82, "name": "Gold Wand" }, { "type": 83, "name": "Crossbow" }, { "type": 17, "name": "Wand Crystal (ammo)" }, { "type": 8, "name": "Ethereal Arrows (ammo)" }, { "type": 29, "name": "Claw Orb (ammo)" }, { "type": 30, "name": "Hellstaff Rune (ammo)" }, { "type": 31, "name": "Phoenix Rod Flame (ammo)" }, { "type": 32, "name": "Mace Spheres (ammo)" }, { "type": 2011, "name": "Bag of Holding" }, { "type": 2012, "name": "Crystal Vial" }, { "type": 2013, "name": "Quartz Flask" }, { "type": 2018, "name": "Silver Shield" }, { "type": 2019, "name": "Enchanted Shield" }, { "type": 2025, "name": "Mystic Urn" }, { "type": 83, "name": "Spiritual Health" }, { "type": 2026, "name": "Tome of Power" }, { "type": 2022, "name": "Shadowsphere" }, { "type": 2024, "name": "Wings of Wrath" }, { "type": 2045, "name": "Torch" }, { "type": 2023, "name": "Timebomb of the Ancients" }, { "type": 28, "name": "Morph Ovum" }, { "type": 2044, "name": "Chaos Device" }, { "type": 5, "name": "Green Key" }, { "type": 13, "name": "Blue Key" }, { "type": 6, "name": "Yellow Key" }, { "type": 1000, "name": "Volcano" }, { "type": 1001, "name": "Pod" }, { "type": 1004, "name": "Serpent Torch" }, { "type": 2035, "name": "Barrel" }, { "type": 40, "name": "Chandelier" }, { "type": 47, "name": "Pillar" }, { "type": 48, "name": "Stalactite" }, { "type": 50, "name": "Stalagmite" }, { "type": 52, "name": "Mossy Hanging Skull" }, { "type": 53, "name": "Metal Hanging Skull" }, { "type": 54, "name": "Grey Hanging Skull" }, { "type": 87, "name": "Brown Pillar" }],
                textures: ["BIGDOOR1", "BIGDOOR2", "BIGDOOR3", "BIGDOOR4", "BIGDOOR5", "BIGDOOR6", "BIGDOOR7", "BRASS1", "BRICK01", "BRICK02", "BRICK03", "BRICK04", "BRICK05", "BRICK06", "BRICK07", "BRICK08", "BRICK09", "BRICK10", "CASTLE1", "CASTLE2", "CASTLE3", "CASTLE4", "CASTLE5", "CASTLE6", "CASTLE7", "CEMENT01", "CEMENT02", "CEMENT03", "CEMENT04", "CEMENT05", "DOOR01", "DOOR02", "DOOR03", "DOOR04", "DOOR05", "DOOR06", "DOOR07", "DOOR08", "DOOR09", "DOOR10", "DOOR11", "DOOR12", "DOOR13", "DOOR14", "DOOR15", "DOOR16", "DOOR17", "DOOR18", "DOOR19", "DOOR20", "DOOR21", "DOOR22", "DOOR23", "DOOR24", "EXIT01", "EXIT02", "GLASS01", "GLASS02", "GLASS03", "GLASS04", "GLASS05", "GLASS06", "LAVA01", "LAVA02", "LAVA03", "LAVA04", "LITE01", "LITE02", "LITE03", "LITE04", "LITE05", "MARB01", "MARB02", "MARB03", "MARB04", "MET01", "MET02", "MET03", "MET04", "MET05", "MET06", "MOSS01", "MOSS02", "MOSS03", "MOSS04", "ROCK01", "ROCK02", "ROCK03", "ROCK04", "ROCK05", "SAND01", "SAND02", "SKY01", "SKY02", "SKY03", "SLIME01", "SLIME02", "SNAKE01", "SNAKE02", "SNAKE03", "SNAKE04", "SNAKE05", "STAR01", "STAR02", "STONE01", "STONE02", "STONE03", "STONE04", "STONE05", "STONE06", "STONE07", "STONE08", "STONE09", "STONE10", "STONE11", "STONE12", "STONE13", "STONE14", "SW01", "SW02", "SW03", "SW04", "SW05", "SW06", "SW07", "SW08", "SW09", "SW10", "SW11", "SW12", "SW13", "SW14", "SW15", "SW16", "SW17", "SW18", "SW19", "SW20", "SW21", "SW22", "SW23", "SW24", "VINE01", "VINE02", "VINE03", "WALL01", "WALL02", "WALL03", "WALL04", "WALL05", "WALL06", "WALL07", "WALL08", "WALL09", "WALL10", "WALL11", "WALL12", "WALL13", "WALL14", "WALL15", "WALL16", "WATER01", "WATER02", "WATER03", "WIND01", "WIND02", "WIND03", "WIND04", "WOOD01", "WOOD02", "WOOD03", "WOOD04", "WOOD05", "WOOD06", "WOOD07", "WOOD08", "WOOD09", "WOOD10", "WOOD11", "WOOD12", "WIZWALL1", "WIZWALL2", "WIZWALL3", "WIZWALL4"],
                flats: ["CEIL01", "CEIL02", "CEIL03", "CEIL04", "CEIL05", "CEIL06", "CEIL07", "CEIL08", "CEIL09", "CEIL10", "CEIL11", "FLAT01", "FLAT02", "FLAT03", "FLAT04", "FLAT05", "FLAT06", "FLAT07", "FLAT08", "FLAT09", "FLAT10", "FLAT11", "FLAT12", "FLAT13", "FLAT14", "FLAT15", "FLAT16", "FLAT17", "FLAT18", "FLAT19", "FLAT20", "FLAT21", "FLAT22", "FLAT23", "FLOOR01", "FLOOR02", "FLOOR03", "FLOOR04", "FLOOR05", "FLOOR06", "FLOOR07", "FLOOR08", "FLOOR09", "FLOOR10", "FLOOR11", "FLOOR12", "FLOOR13", "FLOOR14", "FLOOR15", "FLOOR16", "FLOOR17", "FLOOR18", "FLOOR19", "FLOOR20", "FLOOR21", "FLOOR22", "FLOOR23", "FLOOR24", "FLOOR25", "FLOOR26", "FLOOR27", "FLOOR28", "FLOOR29", "FLOOR30", "FLOOR31", "GRASS01", "GRASS02", "LAVA01", "LAVA02", "LAVA03", "LAVA04", "MARB01", "MARB02", "MFLR01", "MFLR02", "MFLR03", "MFLR04", "MFLR05", "MFLR06", "MFLR07", "MFLR08", "SKY01", "SKY02", "SKY03", "SLIME01", "SLIME02", "SLIME03", "SLIME04", "WATER01", "WATER02", "WATER03", "WATER04"],
                music: ["MUS_E1M1", "MUS_E1M2", "MUS_E1M3", "MUS_E1M4", "MUS_E1M5", "MUS_E1M6", "MUS_E1M7", "MUS_E1M8", "MUS_E1M9", "MUS_E2M1", "MUS_E2M2", "MUS_E2M3", "MUS_E2M4", "MUS_E2M5", "MUS_E2M6", "MUS_E2M7", "MUS_E2M8", "MUS_E2M9", "MUS_E3M1", "MUS_E3M2", "MUS_E3M3", "MUS_E3M4", "MUS_E3M5", "MUS_E3M6", "MUS_E3M7", "MUS_E3M8", "MUS_E3M9", "MUS_E4M1", "MUS_E4M2", "MUS_E4M3", "MUS_E4M4", "MUS_E4M5", "MUS_E4M6", "MUS_E4M7", "MUS_E4M8", "MUS_E4M9", "MUS_E5M1", "MUS_E5M2", "MUS_E5M3", "MUS_E5M4", "MUS_E5M5", "MUS_E5M6", "MUS_E5M7", "MUS_E5M8", "MUS_E5M9", "MUS_TITL", "MUS_INTR", "MUS_FINL", "MUS_SHOP", "MUS_PF", "MUS_CHTL"],
                actions: [{ "id": 1, "name": "Door Open Wait Close" }, { "id": 2, "name": "Door Close" }, { "id": 3, "name": "Door Open" }, { "id": 4, "name": "Door Raise" }, { "id": 10, "name": "Plat Down Wait Up" }, { "id": 99, "name": "Secret Exit" }]
            },
            hexen: {
                themes: ["Forteresse Sombre", "Monastère de Glace", "Marais des Morts", "Tour du Mage"],
                things: [{ "type": 100, "name": "Fighter Player Start" }, { "type": 101, "name": "Cleric Player Start" }, { "type": 102, "name": "Mage Player Start" }, { "type": 103, "name": "Pig Player Start" }, { "type": 11, "name": "Deathmatch Start" }, { "type": 3, "name": "Ettin" }, { "type": 6, "name": "Centaur" }, { "type": 5, "name": "Centaur Leader" }, { "type": 1010, "name": "Afrit" }, { "type": 1011, "name": "Green Chaos Serpent" }, { "type": 1012, "name": "Brown Chaos Serpent" }, { "type": 1017, "name": "Slaughtaur" }, { "type": 1018, "name": "Slaughtaur Leader" }, { "type": 1019, "name": "Dark Bishop" }, { "type": 1024, "name": "Stalker" }, { "type": 1025, "name": "Stalker Leader" }, { "type": 1028, "name": "Heresiarch" }, { "type": 160, "name": "Death Wyvern" }, { "type": 120, "name": "Korax (Boss)" }, { "type": 8000, "name": "Timon's Axe" }, { "type": 8001, "name": "Hammer of Retribution" }, { "type": 8002, "name": "Quietus" }, { "type": 8003, "name": "Serpent Staff" }, { "type": 8004, "name": "Firestorm" }, { "type": 8005, "name": "Wraithverge" }, { "type": 8006, "name": "Frost Shards" }, { "type": 8007, "name": "Arc of Death" }, { "type": 8008, "name": "Bloodscourge" }, { "type": 18, "name": "Blue Mana" }, { "type": 19, "name": "Green Mana" }, { "type": 20, "name": "Combined Mana" }, { "type": 8011, "name": "Krater of Might" }, { "type": 8012, "name": "Dragonskin Bracers" }, { "type": 8013, "name": "Mystic Ambit Incant" }, { "type": 8014, "name": "Disc of Repulsion" }, { "type": 8015, "name": "Boots of Speed" }, { "type": 8016, "name": "Torch" }, { "type": 8017, "name": "Quartz Flask" }, { "type": 8018, "name": "Platinum Helmet" }, { "type": 8019, "name": "Mesh Armor" }, { "type": 8020, "name": "Falcon Shield" }, { "type": 8021, "name": "Porkalator" }, { "type": 8022, "name": "Dark Servant" }, { "type": 8023, "name": "Icon of the Defender" }, { "type": 8024, "name": "Banishment Device" }, { "type": 8025, "name": "Flechette" }, { "type": 9001, "name": "Fire Key" }, { "type": 9002, "name": "Steel Key" }, { "type": 9003, "name": "Cave Key" }, { "type": 9004, "name": "Emerald Key" }, { "type": 9005, "name": "Dungeon Key" }, { "type": 9006, "name": "Silver Key" }, { "type": 9007, "name": "Rusty Key" }, { "type": 9008, "name": "Horn Key" }, { "type": 9009, "name": "Swamp Key" }, { "type": 9010, "name": "Castle Key" }, { "type": 10001, "name": "Serpent Torch" }, { "type": 10002, "name": "Chandelier" }, { "type": 10003, "name": "Barrel" }, { "type": 10004, "name": "Brown Pillar" }, { "type": 10005, "name": "Stalactite" }, { "type": 10006, "name": "Stalagmite" }, { "type": 10007, "name": "Candle" }],
                textures: ["BIGDOOR1", "BOLDER01", "BRASS01", "BRASS_A1", "BRICK01", "CASTLE01", "CAVE01", "CRYSTAL1", "DEMON_A1", "DOOR01", "DOOR14", "FIREBAK1", "FLAME_A1", "GATE01", "GLASS01", "ICE01", "LAVA1", "MARBLE01", "METAL01", "MOSS01", "ROCK01", "RUST01", "SKY_1", "STAINED1", "STONE01", "SUPPORT1", "SWITCH01", "TAP01", "TELEPORT", "WALL01", "WATER01", "WOOD01", "WOOD04", "WOODMET1", "WOODGARG"],
                flats: ["CEILING1", "CEILING2", "CEILING3", "CEILING4", "CEILING5", "CEILING6", "CEILING7", "FLAT01", "FLAT02", "FLAT03", "FLAT04", "FLAT05", "FLAT06", "FLAT07", "FLAT08", "FLAT09", "FLAT10", "FLAT11", "FLAT12", "FLAT13", "FLAT14", "FLAT15", "FLAT16", "FLAT17", "FLAT18", "FLAT19", "FLAT20", "FLAT21", "FLAT22", "FLAT23", "FLAT24", "FLAT25", "FLAT26", "FLAT27", "FLAT28", "FLAT29", "FLAT30", "FLAT31", "FLOOR01", "FLOOR02", "FLOOR03", "FLOOR04", "FLOOR05", "FLOOR06", "FLOOR07", "FLOOR08", "FLOOR09", "FLOOR10", "FLOOR11", "FLOOR12", "FLOOR13", "FLOOR14", "FLOOR15", "FLOOR16", "FLOOR17", "FLOOR18", "FLOOR19", "FLOOR20", "FLOOR21", "FLOOR22", "FLOOR23", "FLOOR24", "FLOOR25", "FLOOR26", "FLOOR27", "FLOOR28", "FLOOR29", "FLOOR30", "FLOOR31", "FLOOR32", "FLOOR33", "FLOOR34", "FLOOR35", "FLOOR36", "FLOOR37", "FLOOR38", "FLOOR39", "FLOOR40", "FLOOR41", "FLOOR42", "FLOOR43", "FLOOR44", "FLOOR45", "FLOOR46", "FLOOR47", "FLOOR48", "FLOOR49", "FLOOR50", "FLOOR51", "FLOOR52", "FLOOR53", "FLOOR54", "GRASS01", "GRASS02", "ICE01", "ICE02", "ICE03", "ICE04", "LAVA01", "MUD01", "SKY_1", "SKY_2", "SKY_3", "SKY_4", "SKY_5", "SKY_6", "SKY_7", "SKY_8", "SWAMP01", "SWAMP02", "SWAMP03", "SWAMP04", "WATER01", "WATER02", "WATER03", "WATER04", "WATER05", "WATER06"],
                music: ["MUS_CATH", "MUS_CHURCH", "MUS_CITADEL", "MUS_FOG", "MUS_FORT", "MUS_GIBBET", "MUS_HEDGE", "MUS_ICE", "MUS_LAVA", "MUS_NEC", "MUS_ORB", "MUS_SEM", "MUS_SWMP", "MUS_VILL", "MUS_WINTRO", "MUS_CAST", "MUS_CINTER", "MUS_CORR", "MUS_DEATH", "MUS_DONE", "MUS_END", "MUS_FINALE", "MUS_CHAP"],
                actions: [{ "id": 21, "name": "Door_Open" }, { "id": 80, "name": "ACS_Execute" }, { "id": 81, "name": "ACS_Suspend" }, { "id": 82, "name": "ACS_Terminate" }, { "id": 83, "name": "ACS_LockedExecute" }]
            }
        };

        const dgraphSpecification = `Tu es un level designer senior et un artiste d'environnement spécialisé dans les jeux de tir à la première personne classiques.
Ta mission est de générer un **objet JSON complet et valide** qui décrit la structure et le thème d'une carte de jeu, en respectant scrupuleusement le format abstrait "D-Graph" version 1.5.

**CONTRAINTE FONDAMENTALE : GRAPHE PLANAIRE**
La carte de Doom est un graphe planaire. Cela signifie que les pièces (secteurs) ne peuvent pas se superposer ou se croiser. Tu dois respecter cette contrainte dans la manière dont tu connectes les pièces.

---
**PARTIE 1 : SPÉCIFICATION TECHNIQUE DU FORMAT D-GRAPH v1.5**
---

**1. OBJET RACINE**
- \`format\`: String, REQUIS. Doit être "D-Graph".
- \`version\`: String, REQUIS. Doit être "1.5".
- \`mapInfo\`: Object, REQUIS. Voir section 1.1.
- \`themePalette\`: Object, REQUIS. Voir section 1.2.
- \`rooms\`: Array<Object>, REQUIS. Voir section 1.3.
- \`connections\`: Array<Object>, REQUIS. Voir section 1.4.

**1.1. Spécification de \`mapInfo\`**
- \`game\`: String, REQUIS. Enum: "doom", "doom2", "heretic", "hexen".
- \`map\`: Integer, REQUIS. Numéro de la carte.
- \`name\`: String, REQUIS. Nom de la carte.
- \`music\`: String, REQUIS. Nom du lump de musique (ex: "D_RUNNIN").

**1.2. Spécification de \`themePalette\`**
Définit le vocabulaire visuel. Chaque clé est un concept fonctionnel, et la valeur est un tableau de textures pondérées \`{ "name": String, "weight": Integer }\`.
**Concepts de Palette (liste exhaustive et fixe) :**
- Murs : \`wall_primary\`, \`wall_accent\`, \`wall_support\`, \`wall_secret_indicator\`, \`wall_panel\`.
- Sols/Plafonds : \`floor_primary\`, \`floor_accent\`, \`floor_damage_low\`, \`floor_damage_high\`, \`ceiling_primary\`, \`ceiling_light_source\`, \`ceiling_crusher\`, \`platform_surface\`.
- Portes/Passages : \`door_regular\`, \`door_locked\`, \`door_exit\`, \`door_frame\`, \`stair_riser\`, \`window_grate\`.
- Interrupteurs : \`switch_utility\`, \`switch_exit\`, \`switch_panel_wall\`.
- Mécaniques : \`teleporter_pad\`.

**1.3. Spécification de \`room\`**
- \`id\`: String, REQUIS. Identifiant unique (ex: "salle_de_controle").
- \`parentRoom\`: String | null, REQUIS. ID de la pièce parente si imbriquée, sinon \`null\`.
- \`shapeHint\`: Object, REQUIS. Contient : \`{ "vertices": Integer, "description": String }\`.
- \`properties\`: Object, REQUIS. Contient :
          - \`floor\`, \`ceiling\`: String, REQUIS. Enum: "very_low", "low", "normal", "high", "very_high", "sky".
          - \`lightLevel\`: String, REQUIS. Enum: "very_dark", "dark", "normal", "bright", "flickering", "strobe".
          - \`wallTexture\`, \`floorFlat\`, \`ceilingFlat\`: String, REQUIS. Doivent correspondre à une clé de la \`themePalette\`.
          - \`tag\`: Integer | null, OPTIONNEL. Identifiant numérique unique pour que cette pièce soit ciblée par une action.
- \`contents\`: Object, REQUIS. Contient les tableaux \`monsters\`, \`items\`, \`decorations\`. Chaque élément est un objet \`{ "name": String, "typeId": Integer, "count": Integer }\`.
- \`features\`: Array<Object>, REQUIS. Décrit les actions sur les murs. Chaque élément est un objet \`{ "name": String, "actionId": Integer, "count": Integer, "properties": Object }\`.
        - Les \`properties\` d'une feature peuvent contenir un \`targetTag\`: Integer, OPTIONNEL.

**1.4. Spécification de \`connection\`**
- \`fromRoom\`, \`toRoom\`: String, REQUIS. IDs des pièces connectées.
- \`type\`: String, REQUIS. Enum: "opening", "door", "locked_door", "secret_door", "window", "teleporter".
- \`properties\`: Object, REQUIS. Détails (ex: \`{ "texture": "DOORBLU", "key": "blue" }\`).

**1.5. Exemple Canonique de Structure v1.5**
Cet exemple montre une \`salle_de_controle\` avec un interrupteur (\`feature\`) qui cible le \`tag: 1\`. La pièce \`plateforme_mobile\` possède ce \`tag: 1\` et sera donc affectée par l'interrupteur.
\`\`\`json
{
  "format": "D-Graph",
  "version": "1.5",
  "mapInfo": {
    "game": "doom2",
    "map": 1,
    "name": "Le Complexe Alpha",
    "music": "D_SHAWN"
  },
  "themePalette": {
    "wall_primary": [
      { "name": "TEKWALL1", "weight": 70 },
      { "name": "TEKWALL4", "weight": 30 }
    ],
    "wall_accent": [
      { "name": "METAL5", "weight": 100 }
    ],
    "wall_support": [
      { "name": "SUPPORT3", "weight": 100 }
    ],
    "wall_secret_indicator": [
      { "name": "BRICK11", "weight": 100 }
    ],
    "wall_panel": [
      { "name": "COMPTALL", "weight": 100 }
    ],
    "floor_primary": [
      { "name": "TECH01", "weight": 80 },
      { "name": "FLAT5_4", "weight": 20 }
    ],
    "floor_accent": [
      { "name": "FLAT23", "weight": 100 }
    ],
    "floor_damage_low": [
      { "name": "NUKAGE1", "weight": 100 }
    ],
    "floor_damage_high": [],
    "ceiling_primary": [
      { "name": "CEIL1_1", "weight": 90 },
      { "name": "CEIL1_2", "weight": 10 }
    ],
    "ceiling_light_source": [
      { "name": "TLITE6_1", "weight": 100 }
    ],
    "ceiling_crusher": [],
    "platform_surface": [
      { "name": "PLAT1", "weight": 100 }
    ],
    "door_regular": [
      { "name": "BIGDOOR2", "weight": 100 }
    ],
    "door_locked": [
      { "name": "DOORBLU", "weight": 100 }
    ],
    "door_exit": [
      { "name": "EXITDOOR", "weight": 100 }
    ],
    "door_frame": [
      { "name": "DOORTRAK", "weight": 100 }
    ],
    "stair_riser": [
      { "name": "STEP4", "weight": 100 }
    ],
    "window_grate": [
      { "name": "MIDGRATE", "weight": 100 }
    ],
    "switch_utility": [
      { "name": "SW1STAR", "weight": 100 }
    ],
    "switch_exit": [
      { "name": "SW1EXIT", "weight": 100 }
    ],
    "switch_panel_wall": [
      { "name": "SWTCHPNL", "weight": 100 }
    ],
    "teleporter_pad": [
      { "name": "GATE1", "weight": 100 }
    ]
  },
  "rooms": [
    {
      "id": "start_chamber", "parentRoom": null,
      "shapeHint": { "vertices": 4, "description": "Petite pièce de départ rectangulaire." },
      "properties": { "floor": "normal", "ceiling": "normal", "lightLevel": "normal", "wallTexture": "wall_primary", "floorFlat": "floor_primary", "ceilingFlat": "ceiling_primary", "tag": null },
      "contents": { "items": [{ "name": "Player1Start", "typeId": 1, "count": 1 }, { "name": "Shotgun", "typeId": 2007, "count": 1 }] },
      "features": []
    },
    {
      "id": "main_hub", "parentRoom": null,
      "shapeHint": { "vertices": 8, "description": "Grand hub octogonal avec un pilier central et plusieurs sorties." },
      "properties": { "floor": "normal", "ceiling": "high", "lightLevel": "bright", "wallTexture": "wall_primary", "floorFlat": "floor_accent", "ceilingFlat": "ceiling_primary", "tag": null },
      "contents": { "monsters": [{ "name": "Imp", "typeId": 3001, "count": 3 }] },
      "features": []
    },
    {
      "id": "central_pillar", "parentRoom": "main_hub",
      "shapeHint": { "vertices": 4, "description": "Pilier de support structurel." },
      "properties": { "floor": "normal", "ceiling": "high", "lightLevel": "bright", "wallTexture": "wall_support", "floorFlat": "floor_accent", "ceilingFlat": "ceiling_primary", "tag": null },
      "contents": {}, "features": []
    },
    {
      "id": "control_room", "parentRoom": null,
      "shapeHint": { "vertices": 4, "description": "Salle de contrôle surélevée." },
      "properties": { "floor": "high", "ceiling": "normal", "lightLevel": "normal", "wallTexture": "wall_panel", "floorFlat": "floor_primary", "ceilingFlat": "ceiling_light_source", "tag": null },
      "contents": { "monsters": [{ "name": "Shotgun Guy", "typeId": 9, "count": 1 }] },
      "features": [
        { "name": "LiftSwitch", "actionId": 18, "count": 1, "properties": { "texture": "SW1STAR", "targetTag": 1 } }
      ]
    },
    {
      "id": "lift_platform", "parentRoom": "main_hub",
      "shapeHint": { "vertices": 4, "description": "Plateforme d'ascenseur." },
      "properties": { "floor": "low", "ceiling": "high", "lightLevel": "normal", "wallTexture": "wall_support", "floorFlat": "platform_surface", "ceilingFlat": "ceiling_primary", "tag": 1 },
      "contents": {}, "features": []
    },
    {
      "id": "blue_key_ledge", "parentRoom": null,
      "shapeHint": { "vertices": 4, "description": "Corniche élevée accessible par l'ascenseur." },
      "properties": { "floor": "high", "ceiling": "high", "lightLevel": "normal", "wallTexture": "wall_primary", "floorFlat": "floor_primary", "ceilingFlat": "ceiling_primary", "tag": null },
      "contents": { "items": [{ "name": "Blue Keycard", "typeId": 5, "count": 1 }] },
      "features": []
    },
    {
      "id": "secret_passage", "parentRoom": null,
      "shapeHint": { "vertices": 4, "description": "Couloir secret." },
      "properties": { "floor": "normal", "ceiling": "normal", "lightLevel": "dark", "wallTexture": "wall_primary", "floorFlat": "floor_primary", "ceilingFlat": "ceiling_primary", "tag": null },
      "contents": { "items": [{ "name": "Soulsphere", "typeId": 83, "count": 1 }] },
      "features": []
    },
    {
      "id": "exit_teleporter_room", "parentRoom": null,
      "shapeHint": { "vertices": 4, "description": "Pièce finale avec un téléporteur." },
      "properties": { "floor": "normal", "ceiling": "normal", "lightLevel": "bright", "wallTexture": "wall_accent", "floorFlat": "teleporter_pad", "ceilingFlat": "ceiling_light_source", "tag": null },
      "contents": { "monsters": [{ "name": "Hell Knight", "typeId": 69, "count": 1 }] },
      "features": []
    }
  ],
  "connections": [
    { "fromRoom": "start_chamber", "toRoom": "main_hub", "type": "opening", "properties": {} },
    { "fromRoom": "main_hub", "toRoom": "control_room", "type": "opening", "properties": {"description": "Un escalier monte à la salle de contrôle."} },
    { "fromRoom": "control_room", "toRoom": "lift_platform", "type": "window", "properties": {"texture_concept": "window_grate", "description": "Fenêtre de surveillance."} },
    { "fromRoom": "lift_platform", "toRoom": "blue_key_ledge", "type": "opening", "properties": {"description": "L'ascenseur monte jusqu'à cette corniche."} },
    { "fromRoom": "main_hub", "toRoom": "secret_passage", "type": "secret_door", "properties": {"texture_concept": "wall_secret_indicator"} },
    { "fromRoom": "main_hub", "toRoom": "exit_teleporter_room", "type": "locked_door", "properties": {"texture_concept": "door_locked", "key": "blue"} }
  ]
}
\`\`\`
`;
        const gameSelect = document.getElementById('gameSelect');
        const themeSelect = document.getElementById('themeSelect');
        const customThemeContainer = document.getElementById('customThemeContainer');
        const customThemeInput = document.getElementById('customThemeInput');

        function updateThemes() {
            const selectedGame = gameSelect.value;
            themeSelect.innerHTML = '';
            const themes = GAME_DATA[selectedGame].themes;
            const customOption = document.createElement('option');
            customOption.value = 'custom'; customOption.textContent = '-- Autre (spécifier) --';
            const randomOption = document.createElement('option');
            randomOption.value = 'random'; randomOption.textContent = '-- Aléatoire --';
            themeSelect.appendChild(randomOption);
            themes.forEach(themeName => { const option = document.createElement('option'); option.value = themeName; option.textContent = themeName; themeSelect.appendChild(option); });
            themeSelect.appendChild(customOption);
        }

        function handleThemeChange() {
            customThemeContainer.style.display = (themeSelect.value === 'custom') ? 'block' : 'none';
            generatePrompt();
        }

        function generatePrompt() {
            const game = gameSelect.value;
            let themeName = themeSelect.value === 'custom' ? (customThemeInput.value || "Thème personnalisé non défini") : themeSelect.value;
            if (themeName === 'random') {
                const themes = GAME_DATA[game].themes;
                const randomIndex = Math.floor(Math.random() * themes.length);
                themeName = themes[randomIndex];
            }

            const size = document.getElementById('sizeSelect').value;
            const connectivity = document.getElementById('connectivitySelect').value;
            const description = document.getElementById('descriptionText').value;

            const data = GAME_DATA[game];

            const textureListText = `**Textures de Murs Valides (\`textures\`):**
La liste complète suivante doit être utilisée.
${data.textures.join(', ')}`;

            const flatListText = `**Textures de Sol/Plafond Valides (\`flats\`):**
La liste complète suivante doit être utilisée.
${data.flats.join(', ')}`;

            const musicListText = `**Musiques Valides (\`music\`):**
La liste complète suivante doit être utilisée.
${data.music.join(', ')}`;

            const actionListText = `**Actions Valides (\`actionId\` pour les features):**
${data.actions.map(t => `- ${t.name} (actionId: ${t.id})`).join('\n')}`;

            let gameDataReference = `---
**PARTIE 2 : VOCABULAIRE VISUEL ET D'ENTITÉS POUR ${game.toUpperCase()}**
---
Pour accomplir ta mission, tu dois utiliser exclusivement les noms et IDs de la base de données suivante pour remplir la \`themePalette\` et les \`contents\`.

${textureListText}

${flatListText}

${musicListText}

**Things Valides (Monstres, Objets, etc.):**
${data.things.map(t => `- ${t.name} (typeId: ${t.type})`).join('\n')}

${actionListText}
`;

            let creativeBrief = `---
**PARTIE 3 : VOTRE MISSION**
---
Ton travail se déroule en deux tâches séquentielles.

**TÂCHE 1 : DÉFINIR LA DIRECTION ARTISTIQUE**
En te basant sur le thème demandé, conçois et écris un objet \`themePalette\` complet et cohérent. Choisis des textures et des flats dans le vocabulaire fourni à la Partie 2 qui évoquent le mieux l'ambiance du thème.

**TÂCHE 2 : CONSTRUIRE LA CARTE**
En utilisant la palette que TU as créée à la tâche 1, conçois et écris les objets \`rooms\` et \`connections\` pour la carte.

**Objectifs de Conception :**
- **Jeu :** ${game}
- **Thème Directeur :** ${themeName}
- **Taille :** ${size}
- **Connectivité / Structure :** ${connectivity}
- **Brief Créatif Additionnel :** ${description || "Aucun. Liberté créative totale."}

**Instructions Finales**

1.  **JSON Uniquement :** Ta réponse doit être UNIQUEMENT le bloc de code JSON complet.
2.  **Respecter la Planéité :** Le graphe de pièces doit pouvoir exister dans un espace 2D sans se croiser.
3.  **Contrainte de Cohérence des Assets :** Tu dois utiliser **exclusivement** les noms (textures, flats, things, musique) de la base de données fournie pour le jeu '${game}'. N'utilise aucun asset d'un autre jeu.
4.  **Règle d'Or - Sémantique des Propriétés :** C'est la règle la plus importante. Sois extrêmement précis sur la signification des propriétés d'une pièce :
        * Les propriétés 'floor' et 'ceiling' définissent la **HAUTEUR** abstraite (ex: '"low"', '"normal"').
        * Les propriétés 'floorFlat' et 'ceilingFlat' définissent le **STYLE** de la surface et doivent pointer vers un concept de la 'themePalette' (ex: '"floor_damage_low"').
        * **NE PAS FAIRE :** '{ "floor": "damaging_low", ... }'
        * **FAIRE :** '{ "floor": "low", "floorFlat": "floor_damage_low", ... }'
5.  **Respect des Énumérations (Enum) :** Plusieurs propriétés, comme 'connection.type' ou 'properties.lightLevel', ont une liste de valeurs autorisées (Enum) définie dans la spécification. Tu dois **exclusivement** utiliser les valeurs de cette liste. N'invente **jamais** de nouvelles valeurs pour ces champs.
        * Par exemple, n'utilise pas '"lift"' ou '"stair"' comme 'type' de connexion.
6.  **Modélisation des Concepts Spécifiques :** Pour représenter correctement certaines mécaniques de jeu, suis ces conventions :
        * Pour modéliser un **escalier** entre deux pièces, crée une connexion de type '"opening"' et assigne des valeurs de 'floor' différentes aux deux pièces (ex: 'room_a' a '"floor": "normal"' et 'room_b' a '"floor": "high"').
        * Pour modéliser un **ascenseur (lift)**, crée une 'feature' de type '"PlatformLift"' à l'intérieur de la pièce ('room') où il se trouve.
7.  **Cohérence des IDs :** Tous les identifiants ('id' de pièce, 'parentRoom', 'fromRoom', 'toRoom') et les références aux concepts de la 'themePalette' doivent être exacts et cohérents à travers tout le document.
8.  **Validation Croisée des Concepts de Palette : Assure-toi que le concept de la themePalette que tu utilises correspond à la propriété que tu définis.
      Les concepts sont groupés par fonction (Murs, Sols/Plafonds, etc.). Respecte cette logique.
      Une propriété comme floorFlat ou ceilingFlat doit uniquement faire référence à un concept de la catégorie 'Sols/Plafonds' (ex: floor_primary, floor_damage_low, ceiling_light_source).
      Une propriété comme wallTexture doit faire référence à un concept de la catégorie 'Murs'.
      NE PAS FAIRE : { "floorFlat": "stair_riser", ... } car stair_riser est un concept de mur (contremarche), pas un concept de sol.
`;

            document.getElementById('promptOutput').value = dgraphSpecification + gameDataReference + creativeBrief;
        }

        function copyPrompt() {
            const output = document.getElementById('promptOutput');
            if (output.value) { output.select(); navigator.clipboard.writeText(output.value).then(() => { const button = document.getElementById('copyButton'); const originalText = button.textContent; button.textContent = 'Copié !'; setTimeout(() => { button.textContent = originalText; }, 2000); }); }
        }

        function initialize() {
            updateThemes();
            handleThemeChange();
        }

        document.getElementById('generateButton').addEventListener('click', generatePrompt);
        document.getElementById('copyButton').addEventListener('click', copyPrompt);
        gameSelect.addEventListener('change', initialize);
        themeSelect.addEventListener('change', handleThemeChange);
        customThemeInput.addEventListener('input', generatePrompt);
        document.getElementById('sizeSelect').addEventListener('change', generatePrompt);
        document.getElementById('connectivitySelect').addEventListener('change', generatePrompt);
        document.getElementById('descriptionText').addEventListener('input', generatePrompt);

        window.addEventListener('load', initialize);
    </script>
</body>
</html>